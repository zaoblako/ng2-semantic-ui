{"version":3,"file":"search.js","sourceRoot":"","sources":["../../../../src/modules/search/components/search.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    Component, ViewChild, HostBinding, Input, AfterViewInit, HostListener,\n    EventEmitter, Output, Directive, ElementRef, TemplateRef, Renderer2, OnDestroy\n} from \"@angular/core\";\nimport { Util, ITemplateRefContext, IFocusEvent } from \"../../../misc/util/index\";\nimport { DropdownService, SuiDropdownMenu } from \"../../dropdown/index\";\nimport { ISearchLocaleValues, RecursivePartial, SuiLocalizationService } from \"../../../behaviors/localization/index\";\nimport { SearchService } from \"../services/search.service\";\nimport { LookupFn, FilterFn } from \"../helpers/lookup-fn\";\n\nexport interface IResultContext<T> extends ITemplateRefContext<T> {\n    query:string;\n}\n\n@Component({\n    selector: \"sui-search\",\n    template: `\n<div class=\"ui input\" [class.icon]=\"hasIcon\" (click)=\"onClick($event)\">\n    <input class=\"prompt\" type=\"text\" [attr.placeholder]=\"placeholder\" autocomplete=\"off\" [(ngModel)]=\"query\">\n    <i *ngIf=\"hasIcon\" class=\"search icon\"></i>\n</div>\n<div class=\"results\"\n     suiDropdownMenu\n     [menuTransition]=\"transition\"\n     [menuTransitionDuration]=\"transitionDuration\"\n     menuSelectedItemClass=\"active\">\n\n    <sui-search-result *ngFor=\"let r of results\"\n                       class=\"item\"\n                       [value]=\"r\"\n                       [query]=\"query\"\n                       [formatter]=\"resultFormatter\"\n                       [template]=\"resultTemplate\"\n                       (click)=\"select(r)\"></sui-search-result>\n\n    <div *ngIf=\"results.length == 0\" class=\"message empty\">\n        <div class=\"header\">{{ localeValues.noResults.header }}</div>\n        <div class=\"description\">{{ localeValues.noResults.message }}</div>\n    </div>\n</div>\n`,\n    styles: [`\n/* Ensures results div has margin. */\n:host {\n    display: inline-block;\n}\n\n/* Fixes positioning when results are pushed above the search. */\n.results {\n    margin-bottom: .5em;\n}\n`]\n})\nexport class SuiSearch<T> implements AfterViewInit, OnDestroy {\n    public dropdownService:DropdownService;\n    public searchService:SearchService<T, T>;\n    private _inputValue:any = false;\n    \n    @ViewChild(SuiDropdownMenu)\n    private _menu:SuiDropdownMenu;\n\n    // Sets the Semantic UI classes on the host element.\n    // Doing it on the host enables use in menus etc.\n    @HostBinding(\"class.ui\")\n    @HostBinding(\"class.search\")\n    private _searchClasses:boolean;\n\n    @HostBinding(\"class.active\")\n    public get isActive():boolean {\n        return this.dropdownService.isOpen;\n    }\n\n    // Sets whether the search element has a visible search icon.\n    @Input()\n    public hasIcon:boolean;\n\n    private _placeholder:string;\n\n    // Gets & sets the placeholder text displayed inside the text input.\n    @Input()\n    public get placeholder():string {\n        return this._placeholder || this.localeValues.placeholder;\n    }\n\n    public set placeholder(placeholder:string) {\n        this._placeholder = placeholder;\n    }\n\n    @Input()\n    public set inputValue(query:string) {\n        this._inputValue = (query == '' || query == null) ? false : query;\n    }\n    \n    private _localeValues:ISearchLocaleValues;\n\n    public localeOverrides:RecursivePartial<ISearchLocaleValues>;\n\n    public get localeValues():ISearchLocaleValues {\n        return this._localizationService.override<\"search\">(this._localeValues, this.localeOverrides);\n    }\n\n    public get query():string {\n        if(this._inputValue) {\n          return this._inputValue;\n        } else {\n          return this.searchService.query;\n        }\n    }\n\n    public set query(query:string) {\n        this._inputValue = false;\n        this.selectedResult = undefined;\n        // Initialise a delayed search.\n        this.searchService.updateQueryDelayed(query, () =>\n            // Set the results open state depending on whether a query has been entered.\n            this.dropdownService.setOpenState(this.searchService.query.length > 0));\n    }\n\n    @Input()\n    public set options(options:T[] | undefined) {\n        if (options) {\n            this.searchService.options = options;\n        }\n    }\n\n    @Input()\n    public set optionsFilter(filter:FilterFn<T> | undefined) {\n        if (filter) {\n            this.searchService.optionsFilter = filter;\n        }\n    }\n\n    @Input()\n    public set optionsLookup(lookupFn:LookupFn<T> | undefined) {\n        this.searchService.optionsLookup = lookupFn;\n    }\n\n    @Input()\n    public set optionsField(field:string | undefined) {\n        this.searchService.optionsField = field;\n    }\n\n    private _resultFormatter?:(r:T, q:string) => string;\n\n    public get resultFormatter():(result:T, query:string) => string {\n        if (this._resultFormatter) {\n            return this._resultFormatter;\n        } else if (this.searchService.optionsLookup) {\n            return r => this.readValue(r);\n        } else {\n            return (r, q) => this.searchService.highlightMatches(this.readValue(r), q);\n        }\n    }\n\n    @Input()\n    public set resultFormatter(formatter:(result:T, query:string) => string) {\n        this._resultFormatter = formatter;\n    }\n\n    @Input()\n    public resultTemplate:TemplateRef<IResultContext<T>>;\n\n    @Input()\n    public retainSelectedResult:boolean;\n\n    @Input()\n    public set searchDelay(delay:number) {\n        this.searchService.searchDelay = delay;\n    }\n\n    @HostBinding(\"class.loading\")\n    public get isSearching():boolean {\n        return this.searchService.isSearching;\n    }\n\n    @Input()\n    public maxResults:number;\n\n    public get results():T[] {\n        return this.searchService.results.slice(0, this.maxResults);\n    }\n\n    // Stores the currently selected result.\n    public selectedResult?:T;\n\n    // Emits whenever a new result is selected.\n    @Output(\"resultSelected\")\n    public onResultSelected:EventEmitter<T>;\n\n    @Input()\n    public transition:string;\n\n    @Input()\n    public transitionDuration:number;\n\n    private _documentClickListener:() => void;\n\n    constructor(private _element:ElementRef, renderer:Renderer2, private _localizationService:SuiLocalizationService) {\n        this.dropdownService = new DropdownService();\n        this.searchService = new SearchService<T, T>();\n\n        this.onLocaleUpdate();\n        this._localizationService.onLanguageUpdate.subscribe(() => this.onLocaleUpdate());\n\n        this._searchClasses = true;\n        this.hasIcon = true;\n        this.retainSelectedResult = true;\n        this.searchDelay = 200;\n        this.maxResults = 7;\n\n        this.onResultSelected = new EventEmitter<T>();\n\n        this.transition = \"scale\";\n        this.transitionDuration = 200;\n\n        this._documentClickListener = renderer.listen(\"document\", \"click\", (e:MouseEvent) => this.onDocumentClick(e));\n    }\n\n    public ngAfterViewInit():void {\n        this._menu.service = this.dropdownService;\n    }\n\n    private onLocaleUpdate():void {\n        this._localeValues = this._localizationService.get().search;\n    }\n\n    // Selects a result.\n    public select(result:T):void {\n        this.onResultSelected.emit(result);\n        this.dropdownService.setOpenState(false);\n\n        if (this.retainSelectedResult) {\n            this.selectedResult = result;\n            this.searchService.updateQuery(this.readValue(result));\n        } else {\n            this.searchService.updateQuery(\"\");\n        }\n    }\n\n    public onClick(e:MouseEvent):void {\n        this.open();\n    }\n\n    @HostListener(\"focusin\")\n    private onFocusIn():void {\n        if (!this.dropdownService.isAnimating) {\n            this.open();\n        }\n    }\n\n    private open():void {\n        if (this.searchService.query.length > 0) {\n            // Only open on click when there is a query entered.\n            this.dropdownService.setOpenState(true);\n        }\n    }\n\n    @HostListener(\"focusout\", [\"$event\"])\n    private onFocusOut(e:IFocusEvent):void {\n        if (!this._element.nativeElement.contains(e.relatedTarget)) {\n            this.dropdownService.setOpenState(false);\n        }\n    }\n\n    public onDocumentClick(e:MouseEvent):void {\n        if (!this._element.nativeElement.contains(e.target)) {\n            this.dropdownService.setOpenState(false);\n        }\n    }\n\n    // Reads the specified field from an item.\n    public readValue(object:T):string {\n        return Util.Object.readValue<T, string>(object, this.searchService.optionsField);\n    }\n\n    public ngOnDestroy():void {\n        this._documentClickListener();\n    }\n}\n"]}