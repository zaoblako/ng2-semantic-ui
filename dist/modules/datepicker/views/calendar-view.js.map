{"version":3,"file":"calendar-view.js","sourceRoot":"","sources":["../../../../src/modules/datepicker/views/calendar-view.ts"],"names":[],"mappings":";;;;;;;;;AAAA,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,YAAY,EAAqD,MAAM,eAAe,CAAC;AAClH,OAAO,EAAE,OAAO,EAAE,MAAM,0BAA0B,CAAC;AACnD,OAAO,EAAgB,eAAe,EAAE,MAAM,6BAA6B,CAAC;AAC5E,OAAO,EAAE,eAAe,EAAE,MAAM,8BAA8B,CAAC;AAG/D,MAAM,CAAN,IAAY,gBAMX;AAND,WAAY,gBAAgB;IACxB,uDAAQ,CAAA;IACR,yDAAS,CAAA;IACT,uDAAQ,CAAA;IACR,uDAAQ,CAAA;IACR,2DAAU,CAAA;AACd,CAAC,EANW,gBAAgB,KAAhB,gBAAgB,QAM3B;AAGD;IAqCI,sBAAY,QAAkB,EAAE,QAAyB,EAAE,MAA2B;QAAtF,iBAKC;QAJG,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;QACtB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QAErB,IAAI,CAAC,wBAAwB,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAU,EAAE,SAAS,EAAE,UAAC,CAAe,IAAK,OAAA,KAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,EAAzB,CAAyB,CAAC,CAAC;IAC3H,CAAC;IAjCD,sBAAW,iCAAO;aAYlB;YACI,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;QACzB,CAAC;aAdD,UAAmB,OAAuB;YAD1C,iBAWC;YATG,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;YACxB,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAEjC,IAAI,CAAC,OAAO,CAAC,cAAc,GAAG;gBAC1B,KAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBAEtB,OAAO,KAAI,CAAC,gBAAgB,CAAC;gBAC7B,KAAI,CAAC,aAAa,EAAE,CAAC;YACzB,CAAC,CAAC;QACN,CAAC;;;OAAA;IAQD,sBAAW,qCAAW;aAAtB;YACI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;QACpC,CAAC;;;OAAA;IAED,sBAAW,sCAAY;aAAvB;YACI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC;QACrC,CAAC;;;OAAA;IAWD,mBAAmB;IAEZ,8BAAO,GAAd,UAAe,IAAiB;QAC5B,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;IACnD,CAAC;IAEM,8BAAO,GAAd;QACI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACrC,CAAC;IAED,mBAAmB;IAEZ,sCAAe,GAAtB;QAAA,iBAGC;QAFG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,SAAS,CAAC,cAAM,OAAA,KAAI,CAAC,sBAAsB,EAAE,EAA7B,CAA6B,CAAC,CAAC;QAC3E,IAAI,CAAC,sBAAsB,EAAE,CAAC;IAClC,CAAC;IAEO,6CAAsB,GAA9B;QAAA,iBAUC;QATG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,UAAA,CAAC;YACzB,OAAA,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,UAAC,QAAgB;gBACpC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACX,KAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;gBAC/B,CAAC;YACL,CAAC,CAAC;QAJF,CAIE,CAAC,CAAC;QAER,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAC9C,CAAC;IAEO,oCAAa,GAArB;QAAA,iBAUC;QATG,IAAI,IAAI,GAAG,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC;QAC3H,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACxF,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC;QACtC,CAAC;QAED,IAAM,oBAAoB,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,EAA5C,CAA4C,CAAC,CAAC;QAC/G,EAAE,CAAC,CAAC,oBAAoB,IAAI,CAAC,oBAAoB,CAAC,UAAU,CAAC,CAAC,CAAC;YAC3D,IAAI,CAAC,gBAAgB,GAAG,oBAAoB,CAAC;QACjD,CAAC;IACL,CAAC;IAEO,oCAAa,GAArB,UAAsB,IAA6B;QAC/C,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACP,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,QAAQ,GAAG,KAAK,EAAlB,CAAkB,CAAC,CAAC;YACrD,IAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,UAAA,EAAE,IAAI,OAAA,EAAE,CAAC,IAAI,KAAK,IAAI,EAAhB,CAAgB,CAAC,CAAC;YAClE,EAAE,CAAC,CAAC,QAAQ,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACjC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACzB,QAAQ,CAAC,cAAc,CAAC,aAAa,EAAE,CAAC;YAC5C,CAAC;YAED,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QACjC,CAAC;IACL,CAAC;IAEO,wCAAiB,GAAzB,UAA0B,CAAe;QACrC,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;YACvD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACpC,MAAM,CAAC;QACX,CAAC;QAED,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;YACzB,IAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC;QAED,IAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QACnE,IAAI,eAAe,GAAG,IAAI,CAAC;QAC3B,IAAI,KAAK,GAAG,CAAC,CAAC;QAEd,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YAChB,KAAK,OAAO,CAAC,KAAK;gBACd,KAAK,IAAI,CAAC,CAAC;gBACX,KAAK,CAAC;YACV,KAAK,OAAO,CAAC,IAAI;gBACb,KAAK,IAAI,CAAC,CAAC;gBACX,eAAe,GAAG,KAAK,CAAC;gBACxB,KAAK,CAAC;YACV,KAAK,OAAO,CAAC,IAAI;gBACb,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;gBAC7B,KAAK,CAAC;YACV,KAAK,OAAO,CAAC,EAAE;gBACX,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;gBAC7B,eAAe,GAAG,KAAK,CAAC;gBACxB,KAAK,CAAC;YACV;gBACI,MAAM,CAAC;QACf,CAAC;QAED,kDAAkD;QAClD,CAAC,CAAC,cAAc,EAAE,CAAC;QAEnB,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,CAAC;QAExD,EAAE,CAAC,CAAC,QAAQ,IAAI,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;YAClC,MAAM,CAAC;QACX,CAAC;QAED,EAAE,CAAC,CAAC,QAAQ,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC;YACvC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACxC,CAAC;QAED,EAAE,CAAC,CAAC,QAAQ,IAAI,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC;YACtC,EAAE,CAAC,CAAC,KAAK,GAAG,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;gBACtD,eAAe,GAAG,IAAI,CAAC;YAC3B,CAAC;QACL,CAAC;QAED,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACZ,IAAI,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAEzE,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC;YAE5D,EAAE,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;gBAClB,aAAa,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;YACxD,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,aAAa,IAAI,SAAS,CAAC,MAAM,CAAC;YACtC,CAAC;YAED,QAAQ,GAAG,SAAS,CAAC,aAAa,GAAG,KAAK,CAAC,CAAC;YAE5C,EAAE,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;gBACtB,MAAM,CAAC;YACX,CAAC;QACL,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAClC,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC/D,CAAC;IAEM,kCAAW,GAAlB;QACI,IAAI,CAAC,wBAAwB,EAAE,CAAC;IACpC,CAAC;IACL,mBAAC;AAAD,CAAC,AA/KD,IA+KC;;AA1KG;IADC,YAAY,CAAC,eAAe,CAAC;8BACP,SAAS;oDAAkB;AAIlD;IADC,KAAK,EAAE;8BACmB,eAAe;qCAAf,eAAe;2CAUzC","sourcesContent":["import { Input, QueryList, ViewChildren, AfterViewInit, HostListener, Renderer2, OnDestroy } from \"@angular/core\";\nimport { KeyCode } from \"../../../misc/util/index\";\nimport { CalendarItem, SuiCalendarItem } from \"../directives/calendar-item\";\nimport { CalendarService } from \"../services/calendar.service\";\nimport { CalendarRangeService } from \"../services/calendar-range.service\";\n\nexport enum CalendarViewType {\n    Year = 0,\n    Month = 1,\n    Date = 2,\n    Hour = 3,\n    Minute = 4\n}\nexport type CalendarViewResult = [Date, CalendarViewType];\n\nexport abstract class CalendarView implements AfterViewInit, OnDestroy {\n    private _type:CalendarViewType;\n    private _service:CalendarService;\n\n    @ViewChildren(SuiCalendarItem)\n    private _renderedItems:QueryList<SuiCalendarItem>;\n    private _highlightedItem?:CalendarItem;\n\n    @Input()\n    public set service(service:CalendarService) {\n        this._service = service;\n        this.ranges.loadService(service);\n\n        this.service.onManualUpdate = () => {\n            this.ranges.refresh();\n\n            delete this._highlightedItem;\n            this.autoHighlight();\n        };\n    }\n\n    public get service():CalendarService {\n        return this._service;\n    }\n\n    public ranges:CalendarRangeService;\n\n    public get currentDate():Date {\n        return this.service.currentDate;\n    }\n\n    public get selectedDate():Date | undefined {\n        return this.service.selectedDate;\n    }\n\n    private _documentKeyDownListener:() => void;\n\n    constructor(renderer:Renderer2, viewType:CalendarViewType, ranges:CalendarRangeService) {\n        this._type = viewType;\n        this.ranges = ranges;\n\n        this._documentKeyDownListener = renderer.listen(\"document\", \"keydown\", (e:KeyboardEvent) => this.onDocumentKeyDown(e));\n    }\n\n    // Template Methods\n\n    public setDate(item:CalendarItem):void {\n        this.service.changeDate(item.date, this._type);\n    }\n\n    public zoomOut():void {\n        this.service.zoomOut(this._type);\n    }\n\n    // Keyboard Control\n\n    public ngAfterViewInit():void {\n        this._renderedItems.changes.subscribe(() => this.onRenderedItemsChanged());\n        this.onRenderedItemsChanged();\n    }\n\n    private onRenderedItemsChanged():void {\n        this._renderedItems.forEach(i =>\n            i.onFocussed.subscribe((hasFocus:boolean) => {\n                if (hasFocus) {\n                    this.highlightItem(i.item);\n                }\n            }));\n\n        this.autoHighlight();\n        this.highlightItem(this._highlightedItem);\n    }\n\n    private autoHighlight():void {\n        let date = this.selectedDate && this.ranges.current.containsDate(this.selectedDate) ? this.selectedDate : this.currentDate;\n        if (this._highlightedItem && this.ranges.current.containsDate(this._highlightedItem.date)) {\n            date = this._highlightedItem.date;\n        }\n\n        const initiallyHighlighted = this.ranges.current.items.find(i => this.ranges.dateComparer.equal(i.date, date));\n        if (initiallyHighlighted && !initiallyHighlighted.isDisabled) {\n            this._highlightedItem = initiallyHighlighted;\n        }\n    }\n\n    private highlightItem(item:CalendarItem | undefined):void {\n        if (item) {\n            this._renderedItems.forEach(i => i.hasFocus = false);\n            const rendered = this._renderedItems.find(ri => ri.item === item);\n            if (rendered && !rendered.hasFocus) {\n                rendered.hasFocus = true;\n                rendered.changeDetector.detectChanges();\n            }\n\n            this._highlightedItem = item;\n        }\n    }\n\n    private onDocumentKeyDown(e:KeyboardEvent):void {\n        if (this._highlightedItem && e.keyCode === KeyCode.Enter) {\n            this.setDate(this._highlightedItem);\n            return;\n        }\n\n        if (!this._highlightedItem) {\n            this.autoHighlight();\n        }\n\n        const index = this.ranges.current.findIndex(this._highlightedItem);\n        let isMovingForward = true;\n        let delta = 0;\n\n        switch (e.keyCode) {\n            case KeyCode.Right:\n                delta += 1;\n                break;\n            case KeyCode.Left:\n                delta -= 1;\n                isMovingForward = false;\n                break;\n            case KeyCode.Down:\n                delta += this.ranges.columns;\n                break;\n            case KeyCode.Up:\n                delta -= this.ranges.columns;\n                isMovingForward = false;\n                break;\n            default:\n                return;\n        }\n\n        // Stop these keypresses being captured elsewhere.\n        e.preventDefault();\n\n        let nextItem = this.ranges.current.items[index + delta];\n\n        if (nextItem && nextItem.isDisabled) {\n            return;\n        }\n\n        if (nextItem && !nextItem.isOutsideRange) {\n            return this.highlightItem(nextItem);\n        }\n\n        if (nextItem && nextItem.isOutsideRange) {\n            if (index + delta >= this.ranges.current.inRange.length) {\n                isMovingForward = true;\n            }\n        }\n\n        if (!nextItem) {\n            let adjustedIndex = this.ranges.current.findIndex(this._highlightedItem);\n\n            const nextItems = this.ranges.calc(isMovingForward).inRange;\n\n            if (isMovingForward) {\n                adjustedIndex -= this.ranges.current.inRange.length;\n            } else {\n                adjustedIndex += nextItems.length;\n            }\n\n            nextItem = nextItems[adjustedIndex + delta];\n\n            if (nextItem.isDisabled) {\n                return;\n            }\n        }\n\n        this.ranges.move(isMovingForward);\n        this._highlightedItem = this.ranges.current.find(nextItem);\n    }\n\n    public ngOnDestroy():void {\n        this._documentKeyDownListener();\n    }\n}\n"]}